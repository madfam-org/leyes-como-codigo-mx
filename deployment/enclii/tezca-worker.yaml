service: tezca-worker
image: ghcr.io/madfam-org/tezca/api
command: ["celery", "-A", "apps.indigo", "worker", "--loglevel=info", "--concurrency=4"]
replicas:
  min: 1
  max: 1
resources:
  requests:
    memory: 512Mi
    cpu: 250m
  limits:
    memory: 2Gi
    cpu: 1000m
env:
  # Same DB/Redis/ES env as tezca-api (use envFrom secretRef tezca-secrets)
  - name: DJANGO_SECRET_KEY
    secretRef: tezca-secrets/django-secret-key
  - name: DEBUG
    value: "False"
  - name: DB_ENGINE
    value: "django.db.backends.postgresql"
  - name: DB_NAME
    value: "tezca"
  - name: DB_USER
    secretRef: tezca-secrets/db-user
  - name: DB_PASSWORD
    secretRef: tezca-secrets/db-password
  - name: DB_HOST
    secretRef: tezca-secrets/db-host
  - name: DB_PORT
    value: "5432"
  - name: CELERY_BROKER_URL
    value: "redis://tezca-redis.tezca.svc.cluster.local:6379/0"
  - name: CELERY_RESULT_BACKEND
    value: "redis://tezca-redis.tezca.svc.cluster.local:6379/0"
  - name: ES_HOST
    value: "http://tezca-es.tezca.svc.cluster.local:9200"
